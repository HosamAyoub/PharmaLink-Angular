<div class="pharmacy-management">
    <!-- Header with Search and Filter -->
    <div class="header-controls">
        <div class="search-container">
            <input type="text" placeholder="Search pharmacies..." [(ngModel)]="searchTerm" (input)="onSearch()"
                class="search-input">
            <i class="search-icon"><i class="fa-brands fa-searchengin"></i></i>
        </div>

        <div class="filter-container w-25">
            <select [(ngModel)]="selectedStatus" (change)="onStatusFilter()" class="status-filter">
                <option value="all">All Status</option>
                <option value="active">Active</option>
                <option value="pending">Pending</option>
                <option value="suspended">Suspended</option>
                <option value="rejected">Rejected</option>
            </select>
        </div>
    </div>

    <!-- Pharmacy Table -->
    <div class="pharmacy-table">
        <div class="table-header">
            <div class="header-cell pharmacy-col">PHARMACY</div>
            <div class="header-cell owner-col">OWNER</div>
            <div class="header-cell contact-col">CONTACT</div>
            <div class="header-cell performance-col">PERFORMANCE</div>
            <div class="header-cell status-col">STATUS</div>
            <div class="header-cell actions-col">ACTIONS</div>
        </div>

        <div class="table-body">
            @for(pharmacy of filteredPharmacies; track pharmacy.pharmacyID){
            <div class="table-row">
                <!-- Pharmacy Info -->
                <div class="cell pharmacy-cell">
                    <div class="pharmacy-info">
                        <h3 class="pharmacy-name">{{ pharmacy.name }}</h3>
                        <div class="pharmacy-details">
                            <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
                                fill="none" stroke="var(--orange)" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-map-pin h-3 w-3 mr-1">
                                <path
                                    d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0">
                                </path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            <span class="address">{{ pharmacy.address }}</span>
                        </div>
                        <div class="license">{{ pharmacy.license }}</div>
                    </div>
                </div>

                <!-- Owner -->
                <div class="cell owner-cell">
                    <span class="owner-name">{{pharmacy.ownerName}}</span>
                </div>

                <!-- Contact -->
                <div class="cell contact-cell">
                    <div class="contact-info">
                        <div class="contact-item">
                            <i class="email-icon"><i class="fa-solid fa-envelope"></i></i>
                            <span>{{ pharmacy.email }}</span>
                        </div>
                        <div class="contact-item">
                            <i class="phone-icon"><i class="fa-solid fa-phone"></i></i>
                            <span>{{ pharmacy.phoneNumber }}</span>
                        </div>
                    </div>
                </div>

                <!-- Performance -->
                <div class="cell performance-cell">
                    <div class="performance-metrics">
                        <div class="metric-item">
                            <span class="metric-label">Orders:</span>
                            <span class="metric-value">{{ pharmacy.totalOrders }}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Medicines:</span>
                            <span class="metric-value">{{ pharmacy.totalMedicineInStock }}</span>
                        </div>
                        <div class="d-flex">
                            <span class="metric-label">Rating:</span>
                            <span class="metric-value rating">{{ pharmacy.rate || 'N/A' }}</span>
                            <span *ngIf="pharmacy.rate" class="star">⭐</span>
                        </div>
                        <div class="metric-item revenue">
                            <span class="revenue-amount">${{ pharmacy.totalRevenue.toLocaleString() }}</span>
                        </div>
                    </div>
                </div>

                <!-- Status -->
                <div class="cell status-cell">
                    <span class="status-badge" [ngClass]="getStatusClass(pharmacy.status)">
                        {{ getStatusText(pharmacy.status) }}
                    </span>
                </div>

                <!-- Actions -->
                <div class="cell actions-cell">
                    <div class="action-buttons">
                        <button class="action-btn view-btn" (click)="viewDetails(pharmacy)" title="View Details">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="#3B82F6" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-eye h-4 w-4">
                                <path
                                    d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0">
                                </path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                        <button *ngIf="pharmacy.status === 1 || pharmacy.status === 2" class="action-btn suspend-btn"
                            (click)="suspendPharmacy(pharmacy)" title="Suspend">
                            <i class="fa-regular fa-circle-xmark"></i>
                        </button>
                        <button *ngIf="pharmacy.status === 3 || pharmacy.status === 0" class="action-btn activate-btn"
                            (click)="activatePharmacy(pharmacy)" title="Activate">
                            ✅
                        </button>
                    </div>
                </div>
            </div>
            }
        </div>
    </div>

    <!-- No results message -->
    <div *ngIf="filteredPharmacies.length === 0" class="no-results">
        <p>No pharmacies found matching your criteria.</p>
    </div>
</div>

<!-- Details Modal -->
<div *ngIf="showDetailsModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>Pharmacy Details - {{ selectedPharmacy?.name }}</h2>
            <button class="close-btn" (click)="closeModal()">✕</button>
        </div>

        <div class="modal-body" *ngIf="selectedPharmacy">
            <div class="details-grid">
                <!-- Basic Information -->
                <div class="detail-section">
                    <h3>Basic Information</h3>
                    <div class="detail-item">
                        <label>Name:</label>
                        <span>{{ selectedPharmacy.name }}</span>
                    </div>
                    <div class="detail-item">
                        <label>Owner:</label>
                        <span>{{ selectedPharmacy.ownerName }}</span>
                    </div>
                    <div class="detail-item">
                        <label>License:</label>
                        <span>{{ selectedPharmacy.license }}</span>
                    </div>
                    <div class="detail-item">
                        <label>Join Date:</label>
                        <span>{{ formatDate(selectedPharmacy.joinedDate) }}</span>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="detail-section">
                    <h3>Contact Information</h3>
                    <div class="detail-item">
                        <label>Email:</label>
                        <span>{{ selectedPharmacy.email }}</span>
                    </div>
                    <div class="detail-item">
                        <label>Phone:</label>
                        <span>{{ selectedPharmacy.phoneNumber }}</span>
                    </div>
                    <div class="detail-item">
                        <label>Address:</label>
                        <span>{{ selectedPharmacy.address }}</span>
                    </div>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="performance-section">
                <h3>Performance Metrics</h3>
                <div class="metrics-grid">
                    <div class="metric-card medicines">
                        <div class="metric-number">{{ selectedPharmacy.totalMedicineInStock }}</div>
                        <div class="metric-label">Medicines</div>
                    </div>
                    <div class="metric-card orders">
                        <div class="metric-number">{{ selectedPharmacy.totalOrders }}</div>
                        <div class="metric-label">Orders</div>
                    </div>
                    <div class="metric-card rate">
                        <div class="metric-number">{{ selectedPharmacy.rate || 'N/A' }}</div>
                        <div class="metric-label">Rating</div>
                    </div>
                    <div class="metric-card revenue">
                        <div class="metric-number">${{ selectedPharmacy.totalRevenue.toLocaleString() }}</div>
                        <div class="metric-label">Revenue</div>
                    </div>
                </div>
            </div>

            <!-- Status and Actions -->
            <div class="status-section">
                <div class="current-status">
                    <label>Current Status:</label>
                    <span class="status-badge" [ngClass]="getStatusClass(selectedPharmacy.status)">
                        {{ getStatusText(selectedPharmacy.status) }}
                    </span>
                </div>
                <div class="modal-actions">
                    <button *ngIf="selectedPharmacy.status === 1 || selectedPharmacy.status === 2" class="btn btn-danger"
                        (click)="suspendPharmacy(selectedPharmacy)">
                        Suspend
                    </button>
                    <button *ngIf="selectedPharmacy.status === 0 || selectedPharmacy.status === 3"
                        class="btn btn-success" (click)="activatePharmacy(selectedPharmacy)">
                        Activate
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>