<div class="profile-container">
  <!-- Profile Header Section -->
  <div class="profile-header">
    <!-- User Avatar with Edit Button -->
    <div class="profile-avatar">
      <div class="profile-avatar-circle">
        <span class="profile-avatar-icon">{{
          (profile?.name || "U").charAt(0).toUpperCase()
        }}</span>
      </div>
    </div>

    <!-- Profile Header Information -->
    <div class="profile-header-info">
      <!-- Header Content with Edit Button -->
      <div class="profile-header-content">
        <h1>My Profile</h1>
        <button class="profile-edit-btn" (click)="toggleEditMode()">
          @if (editMode) {
          <span class="edit-icon"><i class="bi bi-floppy"></i></span>
          <span>Save Changes</span>

          } @else {
          <span class="edit-icon"><i class="bi bi-pencil"></i></span>
          <span>Edit Profile</span>
          }
        </button>
      </div>

      <!-- User Main Information Display -->
      <div class="profile-user-main">
        <div class="profile-user-name">
          {{ profile?.name || "User Name" }}
        </div>

        <div class="profile-user-email">
          <i class="fa-solid fa-location-dot text-muted me-2"></i>
          <span>{{ (profile && profile.country) || "Country" }}, </span>
          <span> {{ (profile && profile.address) || "Address" }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab Navigation Bar -->
  <div class="profile-tabs">
    <!-- Personal Information Tab -->
    <button
      class="profile-tab"
      [class.active]="activeTab() === 'personal'"
      (click)="switchTab('personal')"
    >
      <span class="tab-icon"><i class="bi bi-person me-2"></i></span>
      Personal Info
    </button>

    <!-- Medical Info Tab -->
    <button
      class="profile-tab"
      [class.active]="activeTab() === 'medical'"
      (click)="switchTab('medical')"
    >
      <span class="tab-icon"><i class="bi bi-hospital"></i></span>
      Medical Info
    </button>

    <!-- Order History Tab -->
    <button
      class="profile-tab"
      [class.active]="activeTab() === 'orders'"
      (click)="switchTab('orders')"
    >
      <span class="tab-icon"><i class="bi bi-bag me-2"></i></span>
      Order History
    </button>

    <!-- Settings Tab -->
    <button
      class="profile-tab"
      [class.active]="activeTab() === 'settings'"
      (click)="switchTab('settings')"
    >
      <span class="tab-icon"><i class="bi bi-gear me-2"></i></span>
      Settings
    </button>
  </div>

  <!-- Main Content Area - Loading, Profile Data, or Error -->
  @if (isLoading()) {
  <!-- Loading State -->
  <div class="profile-loading">
    <app-loading-spinner></app-loading-spinner>
  </div>
  } @else if (profile) {
  <!-- Profile Content - Main Data Display -->
  <div class="tab-content">
    <!-- Personal Information Tab -->
    @if (activeTab() === 'personal') {
    <div class="personal-info-section">
      <div class="section-header">
        <h2>Personal Information</h2>
        <!-- Edit Mode Actions -->
        @if (editMode) {
        <div class="edit-actions">
          <button class="btn-cancel" (click)="cancelEdit()">Cancel</button>
          <button class="btn-save" (click)="toggleEditMode()">Save</button>
        </div>
        }
      </div>

      <!-- Personal Information Fields Grid -->
      <div class="info-grid">
        <!-- Full Name Field -->
        <div class="info-item">
          <label>Full Name:</label>
          @if (editMode && profile) {
          <input
            type="text"
            [(ngModel)]="profile.name"
            class="profile-input"
            name="name"
            required
          />
          } @else {
          <span>{{ profile.name || "Not provided" }}</span>
          }
        </div>

        <!-- Date of Birth Field -->
        <div class="info-item">
          <label>Date of Birth:</label>
          @if (editMode && profile) {
          <input
            type="date"
            [value]="profile.dateOfBirth | date : 'yyyy-MM-dd'"
            class="profile-input"
            name="dateOfBirth"
            required
          />
          } @else {
          <span>{{ (profile.dateOfBirth | date) || "Not provided" }}</span>
          }
        </div>

        <!-- Gender Field -->
        <div class="info-item">
          <label>Gender:</label>
          @if (editMode && profile) {
          <select
            [(ngModel)]="profile.gender"
            class="profile-select"
            name="gender"
            required=""
          >
            <option [value]="0">Male</option>
            <option [value]="1">Female</option>
          </select>
          } @else {
          <span>
            @if (profile.gender === 0) { Male } @else if (profile.gender === 1)
            { Female } @else { Not specified }
          </span>
          }
        </div>

        <!-- Country Field -->
        <div class="info-item">
          <label>Country:</label>
          @if (editMode && profile) {
          <input
            type="text"
            [(ngModel)]="profile.country"
            class="profile-input"
            name="country"
            required
          />
          } @else {
          <span>{{ profile.country || "Not provided" }}</span>
          }
        </div>

        <!-- Address Field -->
        <div class="info-item full-width">
          <label>Address:</label>
          @if (editMode && profile) {
          <textarea
            [(ngModel)]="profile.address"
            class="profile-textarea"
            rows="3"
            resize="none"
          ></textarea>
          } @else {
          <span>{{ profile.address || "Not provided" }}</span>
          }
        </div>
      </div>
    </div>
    }

    <!-- Medical History Tab -->
    @if (activeTab() === 'medical') {
    <div class="medical-history-section">
      <div class="section-header">
        <h2>Medical Information</h2>
      </div>

      <div class="medical-info">
        <!-- Medical History Section -->
        <div class="medical-section">
          <div class="medical-card">
            <div class="card-header">
              <h3>Medical History</h3>
              <span class="card-icon">🦠</span>
            </div>
            <div class="card-content">
              @if (editMode && profile) {
              <textarea
                [(ngModel)]="profile.medicalHistory"
                class="medical-textarea"
                rows="3"
                placeholder="Enter current diseases..."
                resize="none"
              ></textarea>
              } @else {
              <p>{{ profile.medicalHistory || "No diseases recorded" }}</p>
              }
            </div>
          </div>
        </div>

        <!-- Current Medications Section -->
        <div class="medical-section">
          <div class="medical-card">
            <div class="card-header">
              <h3>Current Medications</h3>
              <span class="card-icon">💊</span>
            </div>
            <div class="card-content">
              @if (editMode && profile) {
              <textarea
                [(ngModel)]="profile.medications"
                class="medical-textarea"
                rows="3"
                placeholder="Enter current medications..."
                resize="none"
              ></textarea>
              } @else {
              <p>{{ profile.medications || "No medications recorded" }}</p>
              }
            </div>
          </div>
        </div>

        <!-- Allergies Section -->
        <div class="medical-section">
          <div class="medical-card">
            <div class="card-header">
              <h3>Allergies</h3>
              <span class="card-icon">🤧</span>
            </div>
            <div class="card-content">
              @if (editMode && profile) {
              <textarea
                [(ngModel)]="profile.allergies"
                class="medical-textarea"
                rows="3"
                placeholder="Enter your allergies..."
                resize="none"
              ></textarea>
              } @else {
              <p>{{ profile.allergies || "No Allergies recorded" }}</p>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
    }

    <!-- Order History Tab -->
    @if (activeTab() === 'orders') {
    <div class="order-history-section">
      <div class="section-header">
        <h2>Order History</h2>
      </div>

      <!-- Placeholder for No Orders -->
      <div class="orders-placeholder">
        <div class="placeholder-icon">📦</div>
        <h3>No Orders Yet</h3>
        <p>
          Your order history will appear here once you make your first purchase.
        </p>
        <button class="cta-button">Browse Products</button>
      </div>
    </div>
    }

    <!-- Account Settings Tab -->
    @if (activeTab() === 'settings') {
    <div class="settings-section">
      <div class="section-header">
        <h2>Account Settings</h2>
      </div>

      <!-- Settings Options Grid -->
      <div class="settings-grid">
        <!-- Email Notifications Setting -->
        <div class="setting-item">
          <div class="setting-info">
            <h4>Email Notifications</h4>
            <p>Receive updates about your orders and promotions</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" checked />
            <span class="slider"></span>
          </label>
        </div>

        <!-- SMS Notifications Setting -->
        <div class="setting-item">
          <div class="setting-info">
            <h4>SMS Notifications</h4>
            <p>Get SMS alerts for order status updates</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </div>

        <!-- Privacy Mode Setting -->
        <div class="setting-item">
          <div class="setting-info">
            <h4>Privacy Mode</h4>
            <p>Hide your profile from other users</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </div>
      </div>
    </div>
    }
  </div>
  } @else {
  <!-- Error State - Profile Data Not Available -->
  <div class="profile-error">
    <div class="error-icon">⚠️</div>
    <h3>Unable to Load Profile</h3>
    <p>
      We're having trouble loading your profile data. Please check your
      connection and try again.
    </p>
    <button class="btn-retry" (click)="loadProfile()">
      <span class="retry-icon">🔄</span>
      Retry Loading
    </button>
  </div>
  }
</div>
